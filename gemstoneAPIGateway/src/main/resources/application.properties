spring.application.name=api-gateway
server.port=9090

# Import config from Config Server
spring.config.import=configserver:http://localhost:9296

# =========================================
# GATEWAY ROUTES CONFIGURATION
# =========================================

# ---- ORDER SERVICE ----
spring.cloud.gateway.routes[0].id=order-service
spring.cloud.gateway.routes[0].uri=lb://order-service
spring.cloud.gateway.routes[0].predicates[0]=Path=/orders/**
spring.cloud.gateway.routes[0].filters[0].name=CircuitBreaker
spring.cloud.gateway.routes[0].filters[0].args.name=orderServiceCircuitBreaker
spring.cloud.gateway.routes[0].filters[0].args.fallbackUri=forward:/orderServiceFallback
spring.cloud.gateway.routes[0].filters[1].name=RequestRateLimiter
spring.cloud.gateway.routes[0].filters[1].args.redis-rate-limiter.replenishRate=1
spring.cloud.gateway.routes[0].filters[1].args.redis-rate-limiter.burstCapacity=1

# ---- PRODUCT SERVICE ----
spring.cloud.gateway.routes[1].id=product-service
spring.cloud.gateway.routes[1].uri=lb://product-service
spring.cloud.gateway.routes[1].predicates[0]=Path=/products/**
spring.cloud.gateway.routes[1].filters[0].name=CircuitBreaker
spring.cloud.gateway.routes[1].filters[0].args.name=productServiceCircuitBreaker
spring.cloud.gateway.routes[1].filters[0].args.fallbackUri=forward:/productServiceFallback
spring.cloud.gateway.routes[1].filters[1].name=RequestRateLimiter
spring.cloud.gateway.routes[1].filters[1].args.redis-rate-limiter.replenishRate=1
spring.cloud.gateway.routes[1].filters[1].args.redis-rate-limiter.burstCapacity=1

# ---- PAYMENT SERVICE ----
spring.cloud.gateway.routes[2].id=payment-service
spring.cloud.gateway.routes[2].uri=lb://payment-service
spring.cloud.gateway.routes[2].predicates[0]=Path=/payments/**
spring.cloud.gateway.routes[2].filters[0].name=CircuitBreaker
spring.cloud.gateway.routes[2].filters[0].args.name=paymentServiceCircuitBreaker
spring.cloud.gateway.routes[2].filters[0].args.fallbackUri=forward:/paymentServiceFallback
spring.cloud.gateway.routes[2].filters[1].name=RequestRateLimiter
spring.cloud.gateway.routes[2].filters[1].args.redis-rate-limiter.replenishRate=1
spring.cloud.gateway.routes[2].filters[1].args.redis-rate-limiter.burstCapacity=1

# =========================================
# RESILIENCE4J CIRCUITBREAKER CONFIGURATION
# =========================================

# ---- ORDER SERVICE CIRCUIT BREAKER ----
resilience4j.circuitbreaker.instances.orderServiceCircuitBreaker.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.orderServiceCircuitBreaker.slidingWindowSize=5
resilience4j.circuitbreaker.instances.orderServiceCircuitBreaker.failureRateThreshold=50
resilience4j.circuitbreaker.instances.orderServiceCircuitBreaker.waitDurationInOpenState=10s

# ---- PRODUCT SERVICE CIRCUIT BREAKER ----
resilience4j.circuitbreaker.instances.productServiceCircuitBreaker.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.productServiceCircuitBreaker.slidingWindowSize=5
resilience4j.circuitbreaker.instances.productServiceCircuitBreaker.failureRateThreshold=50
resilience4j.circuitbreaker.instances.productServiceCircuitBreaker.waitDurationInOpenState=10s

# ---- PAYMENT SERVICE CIRCUIT BREAKER ----
resilience4j.circuitbreaker.instances.paymentServiceCircuitBreaker.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.paymentServiceCircuitBreaker.slidingWindowSize=5
resilience4j.circuitbreaker.instances.paymentServiceCircuitBreaker.failureRateThreshold=50
resilience4j.circuitbreaker.instances.paymentServiceCircuitBreaker.waitDurationInOpenState=10s

# =========================================
# REDIS CONFIGURATION (FOR RATE LIMITER)
# =========================================
spring.redis.host=localhost
spring.redis.port=6379

# =========================================
# MONITORING / ZIPKIN / ACTUATOR
# =========================================
management.tracing.sampling.probability=1.0
management.zipkin.tracing.endpoint=http://localhost:9411/api/v2/spans
management.endpoints.web.exposure.include=*
